---
title: "Relatório ICE"
author: "Douglas Mangini"
date: "18/08/2021"
output: 
  pdf_document:
    keep_md: yes
    toc: TRUE
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = TRUE, eval = FALSE)
```

```{r read_files, include=FALSE, eval=TRUE}

# function to read several scripts into one code chunk

read_files <- function(files) {
  unlist(lapply(files, xfun::read_utf8))
}
```

\newpage

# Introdução {#intro}

O script *municode* (clique [aqui](#municode)) fabrica uma planilha em que estão os maiores municípios do Brasil, seus códigos ibge e população estimada^[<https://www.ibge.gov.br/estatisticas/sociais/populacao/9103-estimativas-de-populacao.html?edicao=28674&t=resultados>]. Esta planilha será carregada em todos os códigos que seguem.  
Os dados de 2021 mostram que Santa Maria - RS foi substituida na lista dos 100 maiores municípios por Marabá - PA, então nesta edição trabalhamos com 101 municípios.    

Abaixo, os nomes que demos aos subdeterminantes para facilitar a comunicação. 

```{r tabela, echo = FALSE, eval = TRUE}

library(magrittr)

tibble::tibble(
determinante = c(rep("Ambiente Regulatório",3),rep("Infraestrutura",2),rep("Mercado",2)),

subdeterminante =  c("Tempo de Processos","Tributação","Complexidade Tributária","Transporte Interurbano","Condições Urbanas","Desenvolvimento Econômico",
                     "Clientes Potenciais"),
nomeclatura =  c("sd11","sd12","sd13","sd21","sd22","sd31","sd32")) %>%
  knitr::kable(caption = "nomeclatura")

```




\newpage



# Ambiente regulatório

## Tempo de processos {#sd11}

clique [aqui](#sd11_script) para ver o script

### Tempo de viabilidade de locação

Fonte: <https://estatistica.redesim.gov.br/tempos-abertura>.  

Período: 2020    

Cidades faltantes: São José do Rio Preto (SP), Jundiaí (SP), Maringá (PR), Anápolis (GO)  

Comentário: A coluna de interesse é *qtde. hh viabilidade end*. Calculamos o tempo médio por município `tempo_médio` e o seu inverso `sd11_localiza`, que é o indicador procurado. Atribuimos nota zero às cidades faltantes. Detalhes estão comentados no script em apêndice.   

### Tempo de registro, cadastro, e viabilidade de nome

fonte: <https://estatistica.redesim.gov.br/tempos-abertura>.  

Período: 2020 

Cidades faltantes: São José do Rio Preto (SP), Jundiaí (SP), Maringá (PR), Anápolis (GO) 

Comentário: As colunas de interesse são *qtde. hh viabilidade de nome*, *qtde. hh liberação dbe*, *qtde. hh horas deferimento*. Agrupamos por estado e somamos as 3 colunas em `tempo_sum`. O indicador é `sd11_nome`, a média simples por estado. Municípios do mesmo estado terão notas iguais.  

### Taxa de congestionamento em tribunais

Fonte: <https://paineis.cnj.jus.br/QvAJAXZfc/opendoc.htm?document=qvw_l%2FPainelCNJ.qvw&host=QVS%40neodimio03&anonymous=true&sheet=shPDPrincipal>  

Período: 2020  

Cidades faltantes: nenhuma

Comentário: Usamos os parâmetros justiça = Justiça Estadual, campos agrupados = Sede Município e tipo de variável = novos, pendentes e baixados. A taxa líquida de congestionamento é definida^[https://www.cnj.jus.br/gestao-estrategica-e-planejamento/estrategia-nacional-do-poder-judiciario-2009-2014/indicadores/03-taxa-de-congestionamento/
] como $$1 - \frac{\text{baixados}}{\text{novos + pendentes}}$$.  



## Tributação {#sd12}

clique [aqui](#sd12_script) para ver o script

### Alíquota interna do ICMS
Fonte: <https://siconfi.tesouro.gov.br/siconfi/index.jsf>  

Período icms: 2020
Período pib:  2018

Comentário: Usamos a tabela Receitas Orçamentárias (Anexo I-C). Trabalhamos apenas com receitas brutas realizadas e a conta 1.1.1.8.02.0.0. O indicador é `sd12_icms`, o inverso do icms por unidade de pib municipal. Detalhes estão comentados no script em apêndice. 

### Alíquota interna do IPTU

Fonte: <https://siconfi.tesouro.gov.br/siconfi/index.jsf>  

Período icms: 2020  
Período pib = 2018 

Cidades faltantes: Brasília (DF), Carapicuíba (SP)  

Comentário: Usamos a tabela Receitas Orçamentárias (Anexo I-C).Trabalhamos apenas com receitas brutas realizadas e as contas   1.1.1.8.01.1.0 e 1.1.1.8.02.3.0. Detalhes estão comentados no script em apêndice. 

### Alíquota interna do ISS

Fonte: <https://siconfi.tesouro.gov.br/siconfi/index.jsf>  

Período icms: 2020  
Período pib = 2018  

Cidades faltantes: Brasília (DF), Carapicuíba (SP), Uberaba (MG), São João de Meriti (RJ)  Belford Roxo (RJ)  

Comentário:  Usamos a tabela Receitas Orçamentárias (Anexo I-C). Detalhes estão comentados no script em apêndice. 


### Qualidade da Gestão Fiscal
Fonte: <https://www.firjan.com.br/ifgf/>  

Período: 2018

Comentário: Não há novos dados desde a última edição do ICE, então usamos os valores passados. 




## Complexidade burocrática {#sd13}

clique [aqui](#sd13_script) para ver o script

### Simplicidade tributária

Fonte: <https://siconfi.tesouro.gov.br/siconfi/index.jsf>  

Período: 2020  

Cidades faltantes: Brasília (DF)

Comentário: Para filtrar as contas orçamentárias corretas, lemos o relatório do ice passado^[pdf_contas.pdf, pp.15-17] no R. O indicador é `sd13_complexidade`, o produto dos índices de Herfindahl-Hirshmann (ihh) e de visibilidade (iv). O ihh é dado pela soma dos quadrados da participação relativa do tributo na arrecadação total. A visibilidade é dada pela participação relativa de uma soma de de tributos^[IPTU, ITBI, ITR, IRRF] na arrecadação total. Detalhes no script em apêndice. 

### CND's municipais

Fonte: <https://www.ibge.gov.br/estatisticas/sociais/saude/10586-pesquisa-de-informacoes-basicas-municipais.html?=&t=downloads>  

Período: 2019  

Comentário: variável binária `sd13_cnd` igual a 1 se município emite certidão negativa de débitos. Utilizamos a quarta aba da planilha, coluna MTIC1211. Detalhes no script em apêndice.

### Atualização de zoneamento

fonte: <https://www.ibge.gov.br/estatisticas/sociais/saude/10586-pesquisa-de-informacoes-basicas-municipais.html?=&t=downloads>  

Período: 2018

Comentário: quantidade de anos desde que o município mudou a lei de zoneamento. O IBGE excluiu essa pergunta na pesquisa MUNIC 2019, então reproduzimos os dados de 2018.  

\newpage





# Infraestrutura

## Transporte interurbano {#sd21}

Para os indicadores de rodovias, portos e aeroportos, importamos os dados georeferenciados de cada estrutura e fizemos operações geométricas para encontrar os indicadores. Por exemplo, encontrar as rodovias que passam por um município reduz-se a encontrar o número de interseções entre o polígono do município e a linha que descreve a estrada. Esses cálculos estão no script em apêndice. [ver script](#sd21_script)  

### Conectividade das rodovias

Fonte dos shape files das rodovias: <http://servicos.dnit.gov.br/vgeo/>  

```{r exemplo_rodovia, echo=FALSE, eval = TRUE, fig.cap="Exemplo de rodovia", out.width = '100%'}

knitr::include_graphics("infraestrutura/rodovias/exemplo_rodovia.png")
```


### Número de decolagens por ano

fonte dos dados de voos: <https://www.anac.gov.br/acesso-a-informacao/dados-abertos/areas-de-atuacao/voos-e-operacoes-aereas/dados-estatisticos-do-transporte-aereo>  

fonte dos Shape files dos aeroportos: <https://www.gov.br/infraestrutura/pt-br/assuntos/dados-de-transportes/bit/bitmodosmapas#mapaero>  

Período: 2020  

Comentário: Decolagens de voos regulares origem no município. Faltam dados para metade dos municípios. Para esses, atribuímos um número total de decolagens com base aeroporto mais próximo (distância euclidiana). 

```{r aeroporto_plot, echo=FALSE, eval = TRUE, fig.cap="Exemplo: estado de SP e aeroportos mais próximos", out.width = '100%'}

knitr::include_graphics("infraestrutura/aeroportos/sp_airports.png")
```


### Distância ao porto mais próximo

fonte dos shape files dos portos: <https://www.gov.br/infraestrutura/pt-br/assuntos/dados-de-transportes/bit/bitmodosmapas>  

Período: 2020  

Comentário: menor distância euclidiana entre o município e os portos públicos ou fluvias do Amazonas. Tivemos problemas com Rio Branco, então fizemos manualmente pelo google maps. 

```{r porto_plot, echo=FALSE, eval = TRUE, fig.cap="Exemplo: centro de Ananindeua-PA e portos mais próximos", out.width = '100%'}

knitr::include_graphics("infraestrutura/portos/ananindeua_ports.png")
```



## Condições urbanas {#sd22}

clique [aqui](#sd22_script) para ver o script

### Acesso à internet rápida

fonte: <https://dados.gov.br/dataset/dados-de-acessos-de-comunicacao-multimidia>  

Período: 2020  

Comentário: número de acessos à internet de alta velocidade (acima de 12Mbps) por habitante.

### Preço médio do m²

fonte: <https://www.zapimoveis.com.br/>  

Período: 2021

Comentário: raspamos o site a procura de imóveis a venda. Extraímos preço e área útil e fizemos a média para cada município. Excluímos da do cálculo os anúncios que implicavam um preço de metro quadrado menor do que 100 reais e maior do que 10.000 reais. Para cada município, somamos o preço de todos os anúncios e dividimos pela soma de todas as áreas. Procuramos por 350 anúncios de cada município. Encontramos ao menos 300 observações para todos os municípios, exceto em 9 (ver coluna `amostra` nos dados finais).  

### Custo da energia elétrica

fonte distribuidoras: <http://www2.aneel.gov.br/relatoriosrig/(S(fgy4psttnrfsam2x1s40fgib))/relatorio.aspx?folder=sfe&report=DistribuidoradecadaMunicipio>  
fonte das tarifas: <https://www.aneel.gov.br/ranking-das-tarifas>  

Período: 2021  

Comentário: Montamos manualmente a base de dados que indica qual distribuidora atende cada município.  

### Taxa de Homicídios

fonte: <http://tabnet.datasus.gov.br/cgi/tabcgi.exe?sim/cnv/obt10br.def>  

Período: 2019  


Comentário: mortes causadas por agressão, ponderado pelo número estimado de habitantes em 2020. No site do datasus, selecionamos Conteúdo igual a *Óbitos p/ Ocorrência* e Grupo CID-10 igual a *agressões*. Os dados em formato excel estão na pasta de arquivos e o [script](#infra) em R para reproduzir o cálculo no apêndice deste documento. 

\newpage
 
 
# Mercados

## Desenvolvimento econômico {#sd31}
clique [aqui](#sd31_script) para ver o script

### índice de desenvolvimento humano

Fonte: <http://www.atlasbrasil.org.br/ranking>  

Período: 2018  

Comentário: Não há novos dados desde a última edição do índice. Apenas adicionamos as colunas código do município e sigla da UF. 

### Crescimento médio real do PIB

Fonte: sidra-IBGE  

Período: 2014 a 2018  

Comentário: crescimento médio do pib municipal. Usamos os pacotes `basedosdados` e `sidrar` para encontrar o pib municipal e calcular o deflator do pib. 

### Número de exportadoras sediadas no município

Fonte 1: Rais-IBGE (via base dos dados)  
Fonte 2: <https://www.gov.br/produtividade-e-comercio-exterior/pt-br/assuntos/comercio-exterior/estatisticas/empresas-brasileiras-exportadoras-e-importadoras>  

Período: 2019  

Comentário: Dividimos o número de empresas exportadoras pelo total de empresas sediadas no município com pelo menos um funcionário.  

## Clientes potenciais {#sd32}
clique [aqui](#sd32_script) para ver o script

### PIB per capita

Fonte: Sidra-IBGE  

Período: 2018

Comentário: Acessamos os dados via base dos dados. Detalhes no script. 

### Proporção de grandes empresas  

Fonte: Rais-IBGE  

Período: 2019  

Comentário: Razão de duas proporções: empresas grandes por empresas médias e médias por pequenas. Acessamos os dados via base dos dados. O tamanho da empresa é dado pela variável `qtde_vinculos_ativos`. Empresas pequenas têm entre 10 e 49 funcionários; médias entre 50 e 249; grandes, acima de 250. 

\newpage 



# Apêndice {-}

### maiores municípios {#municode}

voltar para [introdução](#intro)

```{r municode, code = read_files('municode.R')}
```

\newpage 

### sd11 {#sd11_script}

voltar para [Tempo de Processos](#sd11)

```{r sd11, code = read_files('ambiente_regulatorio/sd11.R')}
```

\newpage 

### sd12 {#sd12_script}

voltar para [Tributação](#sd12)

```{r sd12, code = read_files('ambiente_regulatorio/sd12.R')}
```

\newpage 

### sd13 {#sd13_script}

voltar para [Complexidade Tributária](#sd13)

```{r sd13, code = read_files('ambiente_regulatorio/sd13.R')}
```

\newpage 

### sd21 {#sd21_script}

voltar para [Transporte Interurbano](#sd21)

```{r sd21, code = read_files(paste0("infraestrutura/",c("aeroportos","energia_eletrica","portos","rodovias"),"/","sd21_",c("voos.R", "energia.R","portos.R","rodovias.R")))}

```


\newpage 

### sd22 {#sd22_script}

voltar para [COndições Urbanas](#sd22)

```{r sd22, code = read_files(paste0("infraestrutura/",c("homicidios","internet","terrenos"),"/","sd22_",c("homicidios.R","internet.R","m2.R")))}

```

\newpage 

### sd31 {#sd31_script}

voltar para [Desenvolvimento Econômico](#sd31)

```{r sd31, code = read_files('mercado/sd31.R')}
```

\newpage 

### sd32 {#sd32_script}

voltar para [Clientes Potenciais](#sd32)

```{r sd32, code = read_files('mercado/sd32.R')}
```


